# Документация к проекту "Телеграм-бот для поиска фильмов"

## Описание

Данный проект представляет собой Telegram-бота, который взаимодействует с API фильмов и предоставляет пользователям
возможность искать фильмы и сериалы по различным критериям. Бот поддерживает несколько команд, позволяющих выполнять
различные запросы, связанные с фильмами и сериалами, а также сохранять историю запросов.
Взаимодействие с сервисом КиноПоиск реализован через get-запрос с использованием API ключа.

Ознакомиться с документацией и получить API ключа можно здесь: https://kinopoisk.dev/ 
## Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://gitlab.skillbox.ru/ВАШЕ_ИМЯ/python_basic_diploma.git
   ```
2. Перейдите в директорию проекта:
   ```bash
   cd repo
   ```
3. Установите необходимые зависимости:
   ```bash
   pip install -r requirements.txt
   ```
4. Запустите бота:
   ```bash
   python main.py
   ```
### Создание телеграмм бота и генерация API токена

1. **Откройте Telegram**: Запустите приложение Telegram на вашем телефоне или компьютере.

2. **Найдите BotFather**: В строке поиска введите `@BotFather` и выберите официальный аккаунт.

3. **Начните чат с BotFather**: Нажмите на кнопку "Start" или введите команду `/start`.

4. **Создайте нового бота**:
   - Введите команду `/newbot`.
   - BotFather попросит вас ввести имя для вашего бота. Это имя будет отображаться в Telegram.
   - Затем вам будет предложено ввести уникальный юзернейм для вашего бота. Он должен заканчиваться на "bot" (например, `my_new_bot`).
5. **Получите токен**: После успешного создания бота, BotFather предоставит вам токен доступа. Он будет выглядеть примерно так: `123456789:ABCdefGhIJKlmnoPQRstuVWXyz1234567890`.
   - Сохраните этот токен, так как он понадобится вам для взаимодействия с API Telegram.
   - после чего в корне проекта необходимо создать файл .env и указать в нем полученный токен и API ключ для работы с кинопоиском.

## Команды бота
 1. `movie_search` 

**Описание:** Позволяет пользователю искать фильмы или сериалы по названию.

**Входные параметры:**

- Название фильма/сериала
- Количество выводимых вариантов 


**Вывод:**
Каждый найденный фильм/сериал будет представлен следующей информацией:

- Название
- Описание
- Рейтинг
- Год производства
- Жанр
- Возрастной рейтинг
- Постер (изображение)
- Реализована пагинация после вывода необходимого количества найденных вариантов на одну страницу 
---

 2. `movie_by_rating`

**Описание:** Поиск фильмов или сериалов по рейтингу.

**Входные параметры:**

- Минимальный рейтинг
- Жанр (опционально)
- Количество выводимых вариантов (опционально)

**Вывод:**
Как и в предыдущем случае, выводится информация о найденных фильмах/сериалах.

---

 3. `budget_movie`

**Описание:** Поиск фильмов или сериалов по указанному бюджету.


**Вывод:**
Список фильмов/сериалов с низким бюджетом, содержащий ту же информацию, что и в предыдущих командах.

---

4. `history`

**Описание:** Позволяет пользователю просмотреть историю своих запросов.

**Формат запроса:**
```
/history
```

**Вывод:** 
История запросов будет представлена в виде списка, где каждый элемент содержит:
- Дата поиска
- Название фильма/сериала
- Описание фильма/сериала
- Рейтинг
- Год производства
- Жанр
- Возрастной рейтинг
- Постер
## Архитектура 
Архитектура проекта позволяет дорабатывать и интегрировать модули без изменения основной структуры кода.
### Структура проекта:
**Api**
```
Модуль определеяющий логику взаимодейстия с внешним api.

- int ()
- api_config.py (описывает класс KP_search, который описывает основную логику работы с api kinopoisk).
```
**Config_data**
```
Получение основных данных для иницилизации бота и ключа API подключаемого сервиса "BOT_TOKEN = os.getenv("BOT_TOKEN",
"RAPID_API_KEY") и определяющий соновные команды бота ("DEFAULT_COMMANDS"). 
Данный модуль определяет постоянные переменные используемые в основной структуре проекта.

- int ()
- config.py (Основной код который взаимодействует с файлом .env используя библиотеку dotenv, и ее методы load_dotenv, find_dotenv)
```
**Database**
```
Модуль определяющий логику работы с базой данных.
-init()
-db.py (С помощью библиотеки peewee создает таблицу 'tg_tab.db' и оперделяет основные методы работы с ней)
```
**Handlers**
```
Модуль который описывает логику работы основных функций бота и взаимодействие с пользователем.
-init()
-custom_handlers (подмодуль содержащий файлы описывающими основной функционал телеграмм бота)
 |_init()
 |_history.py (описывает логику взаимодействия пользователя с базой данных посредством модуля database)
 |_init()
 |_movie_serarch.py (описывает логику взаимодействия пользователя с api kinopoisk по команде "поиску фильма/сериала по названию")
 |_select_params.py (описывает логику взаимодействия пользователя с api kinopoisk по команде "Дополнительнве параметры")
-default_handlers (подмодуль содержащий файлы описывающими стандартные команды телеграмм бота "\start" и "\help")
 |_init()
 |_start.py (описывает логику старта бота по команде "\start")
 |_help.py (описывает логику команды "\help")
```
**Keyboards**
```
Модуль иницилиазации reply и inline клавиатуры
-init()
-inline 
 |_init()
 |_inline_config.py (определяет основные функции иницилизирующие inline клавиатуру)
-reply
 |_init()
 |_reply_buttons.py (определяет основные функции иницилизирующие reply клавиатуру)
```
**Loger**
```
Модуль описывает логигу логирования в основной структуре кода. 
-init()
-config_loger.py (описывает класс TelegramBotLogger с использованием библиотеки logging и инициализирует его)
```
**States**
```
Описывает состояния бота.
-init()
-states_bot.py (описывает классы состояния бота с библиотеки aiogram.fsm.state и классов StatesGroup, State)
```
**Utils**
```
Модуль описывает логику используемых утилит бота.
-init()
-misc(подмодуль Utils)
 |_init()
 |_custom_utils.py (описывает работу функций используемых в модуле handlers)
-set_bot_comands.py (Устанавливает основные команды прописанные в модуле config_data)
```
**Файл loader**
Инициализирует экземпляр bot, диспетчера dp и storage для записи состоянии бота.

**Файл main**
Определяет точки входа бота и логику обработки роутеров модуля handlers, запускает телеграмм бота.

**Файл .env**

Файл предназначен для определения в нем токена Вашего телеграмм-бота и ключа API. 
!!!ФАЙЛ СОЗДАЕТСЯ САМОСТОЯТЕЛЬНО В КОРНЕ ПРОЕКТА ПОСЛЕ СОЗДАНИЯ ВИРТУАЛЬНОГО ОКРУЖЕНИЯ!!!
Перед созданием файла ".env" ознакомтесь с ".env.template". 


## Технологии

- Язык программирования: Python не ниже 3 версии
- Библиотеки: `aiogram`, `requests` (для работы с API фильмов), `peewee` (для работы с базой данных)
- API kinopoisk: [пример API](https://api.kinopoisk.dev/v1.4/movie?)
